<h2>Manager Dashboard</h2>
<section>
  <button onclick="viewUsers()">View Employees</button>
</section>

<section>
  <h3>Create Post</h3>
  <form id="postForm">
    <textarea name="content" required></textarea>
    <button type="submit">Post</button>
  </form>
</section>

<section>
  <h3>Posts</h3>
  <ul id="postList"></ul>
</section>

<section>
  <h3>Change Password</h3>
  <form id="passwordForm">
    <input name="password" type="password" placeholder="New Password" required />
    <button type="submit">Update</button>
  </form>
</section>

<script>
  const token = localStorage.getItem('token');

  async function viewUsers() {
    const res = await fetch('/api/users', {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    const data = await res.json();
    alert(JSON.stringify(data));
  }

  document.getElementById('postForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const content = e.target.content.value.trim();
    if (!content) return;
    await fetch('/api/posts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
      body: JSON.stringify({ content })
    });
    e.target.reset();
    loadPosts();
  });

  async function loadPosts() {
    const res = await fetch('/api/posts', {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    const posts = await res.json();
    const list = document.getElementById('postList');
    list.innerHTML = '';
    posts.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.author}: ${p.content} (${new Date(p.createdAt).toLocaleString()})`;
      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.onclick = async () => {
        const content = prompt('Edit post', p.content);
        if (!content) return;
        await fetch(`/api/posts/${p.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
          body: JSON.stringify({ content })
        });
        loadPosts();
      };
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.onclick = async () => {
        await fetch(`/api/posts/${p.id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${token}` }
        });
        loadPosts();
      };
      li.append(editBtn, delBtn);
      list.appendChild(li);
    });
  }

  document.getElementById('passwordForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const password = e.target.password.value;
    await fetch('/api/users/password', {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
      body: JSON.stringify({ password })
    });
    e.target.reset();
  });

  loadPosts();
</script>
